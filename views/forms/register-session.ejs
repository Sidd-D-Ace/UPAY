<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UPAY Portal â€” Register a Session</title>
  <link rel="stylesheet" href="/styles/register-session.css" />
</head>
<body class="page">
  <header class="site-header">
    <h1 class="title">UPAY Portal</h1>
  </header>

  <main class="container">
    <section class="card">
      <!-- Header bar -->
      <div class="card-bar">
        <a href="/<%= basePath %>/dashboard" class="icon-btn" aria-label="Go back">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M15 18l-6-6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </a>
        <h2 class="card-title">Register a Session</h2>
      </div>

      <!-- Form body -->
      <form class="card" method="post" action="/<%= basePath %>/sessions/register-session" enctype="multipart/form-data">

        <div class="card-body">
          <div class="grid">
            
            <!-- Branch -->
            <div class="field">
              <label for="branch">Select Branch</label>
              <select id="branch" name="branch" class="pill" required>
                <option value="">Choose Branch</option>
                <% branches.forEach(branch => { %>
                  <option value="<%= branch.branch_id %>" <% if(branch.branch_id === currentUser.branch_id) { %>selected<% } %>>
                    <%= branch.branch_name %>
                  </option>
                <% }); %>
              </select>
            </div>

            <!-- Conductor -->
            <div class="field">
              <label for="conductor">Conducted by</label>
              <select id="conductor" name="conductor" class="pill" required>
                <option value="<%= currentUser.volunteer_id %>" data-branch="<%= currentUser.branch_id %>" selected>
                  <%= currentUser.name %>
                </option>
                <% volunteers.forEach(vol => { %>
                  <% if(vol.volunteer_id !== currentUser.volunteer_id) { %>
                    <option value="<%= vol.volunteer_id %>" data-branch="<%= vol.branch_id %>">
                      <%= vol.name %>
                    </option>
                  <% } %>
                <% }); %>
              </select>
            </div>

            <!-- Subject -->
            <div class="field">
              <label for="subject">Select Subject</label>
              <select id="subject" name="subject" class="pill" required>
                <option value="">Choose Subject</option>
                <% subjects.forEach(sub => { %>
                  <option value="<%= sub.subject_id %>"><%= sub.name %></option>
                <% }); %>
              </select>
            </div>

            <!-- Topic -->
            <div class="field">
              <label for="topic">Topic</label>
              <input id="topic" name="topic" type="text" class="pill" placeholder="Enter topic" required />
            </div>

            <!-- Class Image -->
            <div class="field">
              <label for="classImage">Upload Class Image</label>
              <div class="file-input-wrapper">
                <input id="classImage" name="classImage" type="file" class="file-input" accept="image/*" />
                <div class="file-display pill">
                  <svg viewBox="0 0 24 24" class="upload-icon">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <polyline points="7,10 12,15 17,10" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <line x1="12" y1="15" x2="12" y2="3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  <span class="file-text">Choose Image</span>
                </div>
              </div>
            </div>

            <!-- Notes PDF/Doc -->
            <div class="field">
              <label for="notes">Upload Notes</label>
              <div class="file-input-wrapper">
                <input id="notes" name="notes" type="file" class="file-input" accept=".pdf,.doc,.docx" />
                <div class="file-display pill">
                  <svg viewBox="0 0 24 24" class="upload-icon">
                    <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" fill="currentColor"/>
                  </svg>
                  <span class="file-text">Choose PDF/Doc</span>
                </div>
              </div>
            </div>

            <!-- Location -->
            <div class="field">
              <label for="location">Location</label>
              <div class="location-wrapper">
                <input id="location" name="location" type="text" class="pill location-input" placeholder="Click to select from map" readonly required />
                <button type="button" class="map-btn" onclick="openMapSelector()">
                  <svg viewBox="0 0 24 24" class="map-icon">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="currentColor"/>
                  </svg>
                </button>
              </div>
            </div>

          </div>
        </div>

        <div class="actions">
          <button type="submit" class="btn">Save & Next</button>
        </div>
      </form>
    </section>
  </main>

  <script>
    // File input display
    document.querySelectorAll('.file-input').forEach(input => {
      input.addEventListener('change', function() {
        const wrapper = this.closest('.file-input-wrapper');
        const display = wrapper.querySelector('.file-text');
        if (this.files.length > 0) {
          display.textContent = this.files[0].name;
        } else {
          display.textContent = this.id === 'classImage' ? 'Choose Image' : 'Choose PDF/Doc';
        }
      });
    });

    // Update Branch when Conductor changes
    document.getElementById('conductor').addEventListener('change', function() {
      const selectedOption = this.options[this.selectedIndex];
      const branchId = selectedOption.getAttribute('data-branch');
      const branchSelect = document.getElementById('branch');
      if (branchId) {
        branchSelect.value = branchId;
      }
    });

    // Map selector placeholder
    function openMapSelector() {
      const locationInput = document.getElementById('location');
      const sampleLocations = [
        'New Delhi, India',
        'Mumbai, Maharashtra',
        'Bangalore, Karnataka',
        'Chennai, Tamil Nadu',
        'Kolkata, West Bengal'
      ];
      const randomLocation = sampleLocations[Math.floor(Math.random() * sampleLocations.length)];
      locationInput.value = randomLocation;
    }
  </script>
</body>
</html>
